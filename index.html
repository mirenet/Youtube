<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Minimal YouTube Audio Player (hidden video, auto-skip ads)</title>
<style>
:root {
  --bg: #0f0f0f;
  --panel: #141414;
  --accent: #1f8cff;
  --muted: #9aa3ad;
  --text: #e6eef6;
}
body{
  margin:0;
  font-family: Inter, system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  padding:22px;
}

.card {
  width:100%;
  max-width:720px;
  background:var(--panel);
  border-radius:10px;
  padding:14px;
  box-shadow:0 6px 18px rgba(0,0,0,0.6);
}

.title {
  font-size:16px;
  font-weight:600;
  margin-bottom:8px;
}

.controls {
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}

button {
  background:#222;
  color:var(--text);
  border:1px solid rgba(255,255,255,0.04);
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}
button:active{ transform:translateY(1px) }
.primary { background:var(--accent); color:#fff; border:none; }
.small { padding:6px 8px; font-size:13px; }

.info { margin-top:10px; color:var(--muted); font-size:13px; }
.seek { width:100%; margin-top:10px; }
input[type="range"] { width:100%; }

#player {
  width: 1px;
  height: 1px;
  position: absolute;
  left: -9999px;
  top: -9999px;
  opacity: 0.0001;
  pointer-events: none;
}

.row { display:flex; justify-content:space-between; gap:12px; align-items:center; }
.muted { color:var(--muted); font-size:13px; }
</style>
</head>
<body>
<div class="card">
  <div class="title">Minimal YouTube Audio Player (hidden video)</div>

  <div class="row">
    <div>
      <strong id="trackTitle">—</strong>
      <div class="info" id="trackInfo">Ready</div>
    </div>
    <div class="muted">Klikni Play da dozvoliš autoplay</div>
  </div>

  <div class="controls" style="margin-top:12px">
    <button id="prevBtn" class="small">⏮ Prev</button>
    <button id="playBtn" class="primary small">▶ Play</button>
    <button id="pauseBtn" class="small">⏸ Pause</button>
    <button id="stopBtn" class="small">■ Stop</button>
    <button id="nextBtn" class="small">⏭ Next</button>

    <div style="flex:1"></div>
    <label class="small muted" for="vol">Vol</label>
    <input id="vol" type="range" min="0" max="100" step="1" value="100" />
  </div>

  <div class="seek">
    <input id="seek" type="range" min="0" max="100" value="0" />
    <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px">
      <span id="currentTime">0:00</span>
      <span id="duration">0:00</span>
    </div>
  </div>

  <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
    <button id="shuffle" class="small">Shuffle off</button>
    <button id="repeat" class="small">Repeat off</button>
    <button id="openIframe" class="small">Open iframe (debug)</button>
  </div>

  <div style="margin-top:8px;color:var(--muted);font-size:13px">
    Player je skriven, reklame se automatski preskaču kad krenu.
  </div>
</div>

<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const playlist = [
  "QNJL6nfu__Q",
  "dQw4w9WgXcQ",
  "3JZ_D3ELwOQ",
  "kJQP7kiw5Fk",
  "9bZkp7q19f0"
];
let current = 0;
let player = null;
let updateTimer = null;
let shuffleOn = false;
let repeatMode = false;
let lastVideoId = playlist[current];

const el = {
  playBtn: document.getElementById('playBtn'),
  pauseBtn: document.getElementById('pauseBtn'),
  stopBtn: document.getElementById('stopBtn'),
  nextBtn: document.getElementById('nextBtn'),
  prevBtn: document.getElementById('prevBtn'),
  vol: document.getElementById('vol'),
  seek: document.getElementById('seek'),
  currentTime: document.getElementById('currentTime'),
  duration: document.getElementById('duration'),
  trackTitle: document.getElementById('trackTitle'),
  trackInfo: document.getElementById('trackInfo'),
  shuffle: document.getElementById('shuffle'),
  repeat: document.getElementById('repeat'),
  openIframe: document.getElementById('openIframe')
};

function fmtTime(s) {
  s = Math.max(0, Math.floor(s));
  const m = Math.floor(s/60);
  const sec = String(s%60).padStart(2,'0');
  return `${m}:${sec}`;
}

function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    height: '1',
    width: '1',
    videoId: playlist[current],
    playerVars: {
      'playsinline': 1,
      'autoplay': 0,
      'controls': 0,
      'rel': 0,
      'modestbranding': 1,
      'disablekb': 1,
      'fs': 0
    },
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange,
      'onError': onPlayerError
    }
  });
}

function onPlayerReady() {
  el.trackInfo.textContent = 'Loaded';
  updateUI();
  player.setVolume(Number(el.vol.value));
}

function onPlayerError(e) {
  console.warn('YT error', e);
  el.trackInfo.textContent = 'Playback error';
}

function onPlayerStateChange(e) {
  if(e.data === YT.PlayerState.PLAYING){
    let vid = player.getVideoData().video_id;
    if(vid !== lastVideoId){
      // reklama detektovana
      console.log("Reklama detektovana, preskacem...");
      setTimeout(()=>{ player.loadVideoById(lastVideoId); }, 500);
    } else {
      startUpdateTimer();
      updateTrackTitle();
    }
  }

  if(e.data === YT.PlayerState.ENDED){
    if(repeatMode){
      player.playVideo();
      return;
    }
    if(shuffleOn){
      current = Math.floor(Math.random()*playlist.length);
    } else {
      current = (current+1) % playlist.length;
    }
    lastVideoId = playlist[current];
    loadAndPlay(current);
  }
}

function startUpdateTimer(){
  stopUpdateTimer();
  updateTimer = setInterval(()=>{
    try{
      const dur = player.getDuration() || 0;
      const cur = player.getCurrentTime() || 0;
      if(dur>0){
        el.seek.value = Math.min(100, Math.floor(cur/dur*100));
        el.currentTime.textContent = fmtTime(cur);
        el.duration.textContent = fmtTime(dur);
      }
    }catch(err){}
  },500);
}
function stopUpdateTimer(){ if(updateTimer){ clearInterval(updateTimer); updateTimer=null; } }

function loadAndPlay(index){
  current = (index + playlist.length) % playlist.length;
  lastVideoId = playlist[current];
  el.trackTitle.textContent = 'Loading...';
  try{
    player.loadVideoById(playlist[current]);
    player.setVolume(Number(el.vol.value));
  }catch(err){ console.warn('load error', err); }
}

function updateTrackTitle(){
  try{
    const meta = player.getVideoData();
    el.trackTitle.textContent = meta && meta.title ? meta.title : playlist[current];
  }catch(err){ el.trackTitle.textContent = playlist[current]; }
}

function updateUI(){
  el.trackTitle.textContent = playlist[current];
  el.trackInfo.textContent = 'Ready';
}

el.playBtn.onclick = ()=>player.playVideo();
el.pauseBtn.onclick = ()=>player.pauseVideo();
el.stopBtn.onclick = ()=>player.stopVideo();
el.nextBtn.onclick = ()=>{ current=(current+1)%playlist.length; lastVideoId=playlist[current]; loadAndPlay(current); };
el.prevBtn.onclick = ()=>{ current=(current-1+playlist.length)%playlist.length; lastVideoId=playlist[current]; loadAndPlay(current); };
el.vol.oninput = ()=>player.setVolume(Number(el.vol.value));
el.seek.oninput = ()=>{ 
  try{
    const dur = player.getDuration()||0;
    player.seekTo(dur*Number(el.seek.value)/100, true);
  }catch(err){}
};
el.shuffle.onclick = ()=>{
  shuffleOn = !shuffleOn;
  el.shuffle.textContent = shuffleOn?'Shuffle on':'Shuffle off';
};
el.repeat.onclick = ()=>{
  repeatMode = !repeatMode;
  el.repeat.textContent = repeatMode?'Repeat on':'Repeat off';
};
el.openIframe.onclick = ()=>window.open(player.getIframe().src,'_blank');

</script>
</body>
</html>
